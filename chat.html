<!DOCTYPE html>
<html>
<head>
  <title>Chat Room</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    input, textarea { display: block; margin: 10px 0; width: 300px; }
    button { margin-top: 5px; }
    ul { list-style-type: none; padding-left: 0; }
  </style>
</head>
<body>
  <h1>üí¨ Chat Room</h1>

  <input id="chatName" placeholder="Your name" />
  <textarea id="chatText" placeholder="Say something..."></textarea>
  <button onclick="sendChat()">Send</button>

  <h3>üó®Ô∏è Chat Log</h3>
  <ul id="chatLog"></ul>

  <script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwLImmugDLVGkErhrIqiZPX6pym7v6EQJQwd7tqcz6hV1ha41Cs9mvHagO5RSmfKxjf/exec';

    async function fetchChat() {
      const res = await fetch(`${SCRIPT_URL}?action=getChat`);
      const data = await res.json();
      const ul = document.getElementById('chatLog');
      ul.innerHTML = '';
      data.messages.forEach(m => {
        const li = document.createElement('li');
        li.textContent = `${m.name}: ${m.text} (${new Date(m.time).toLocaleTimeString()})`;
        ul.appendChild(li);
      });
    }

    async function sendChat() {
      const name = document.getElementById('chatName').value;
      const message = document.getElementById('chatText').value;
      if (!name || !message) return alert('Both fields are required');

      await fetch(`${SCRIPT_URL}?action=addChatMessage`, {
        method: 'POST',
        body: JSON.stringify({ name, message }),
      });
      document.getElementById('chatText').value = '';
      fetchChat();
    }

    fetchChat();
    setInterval(fetchChat, 5000); // Refresh chat every 5s
  </script>
</body>
</html>